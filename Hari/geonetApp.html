<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Intro to graphics - 4.11</title>

    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.11/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.11/"></script>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
      .btn-container {
        position: absolute;
        margin: 10px;
        right: 0;
        z-index: 1;
        cursor: pointer;
      }
    </style>

    <script>
      require(["esri/Map", "esri/views/MapView", "esri/Graphic"], function(
        Map,
        MapView,
        Graphic
      ) {
		var graphics = [];
        // generate n graphics randomly
        var createGraphics = function(n) {
          graphics.length=0;

          while(graphics.length < n) {
            var x = (Math.random() * (view.extent.xmax - view.extent.xmin)) + view.extent.xmin;
            var y = (Math.random() * (view.extent.ymax - view.extent.ymin)) + view.extent.ymin;

            graphics.push(new Graphic({
              geometry: {
                type: 'point',
                x: x,
                y: y,
                spatialReference: view.spatialReference
              },
              symbol: {
                type: 'simple-marker',
                color: 'blue',
                size: 10
              }
            }));
          }

          return graphics;
        }

        var map = new Map({
          basemap: "hybrid"
        });

        var view = new MapView({
          center: [-80, 35],
          container: "viewDiv",
          map: map,
          zoom: 3
        });

        view.when(function() {
          document.getElementById("btnRemove").onclick = function() {
            view.graphics.removeAll();
          }

          document.getElementById("btnGenerate").onclick = function() {
            // memory leak when removing graphics and adding new items.
            view.graphics.removeAll();
            view.graphics.addMany(createGraphics(5000));
          }
        });
      });
    </script>
  </head>

  <body>
    <div class="btn-container">
      <button id="btnRemove">clear</button>
      <button id="btnGenerate">generate graphics</button>
    </div>
    <div id="viewDiv"></div>
  </body>
</html>
