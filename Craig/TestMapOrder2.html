<!DOCTYPE html>
<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta charset="utf-8" />
    <link
      rel="stylesheet"
      href="https://js.arcgis.com/3.29/esri/css/esri.css"
    />
    <script src="https://js.arcgis.com/3.29/"></script>
    <script type="text/javascript">
      require([
        "esri/map",
        "esri/basemaps",
        "esri/SpatialReference",
        "esri/geometry",
        "esri/layers/FeatureLayer",
        "esri/layers/ArcGISDynamicMapServiceLayer",
        "esri/layers/VectorTileLayer",
        "dojo/domReady!"
      ], function(
        Map,
        Basemaps,
        SpatialReference,
        Geometry,
        FeatureLayer,
        ArcGISDynamicMapServiceLayer,
        VectorTileLayer
      ) {
        var url,
          svcLyr0 = null,
          svcLyr1 = null,
          svcLyr2 = null,
          standardLyr = null,
          baseUrl = "",
          basemapName = "",
          baseLayers = "",
          standardUrl = "";
        var spRef,
          layer1Url = "",
          layer2Url = "",
          layer0Url = "",
          layer1Tiled = true,
          layer2Tiled = true,
          mapCenter,
          baseNum = 0;
        var allLayers = [];

        basemapName = "streets-navigation-vector";
        spRef = new SpatialReference({ wkid: 102100 });
        mapCenter = new Geometry.Point(
          -17263933.529700905,
          2239806.092044023,
          spRef
        );

        var mode = 1;

        switch (mode) {
          case 1:
            // Standard ArcGIS basemap with flood zone layer from an arcgis.com server
            // Also a parcels layer - from an arcgis.com FeatureServer
            // As expected by the order of adding the layers, the parcels show on top of the flood zones
            layer1Url =
              "https://services1.arcgis.com/8zEncYIWRcSKYebe/ArcGIS/rest/services/Safety/FeatureServer/1";
            layer2Url =
              "https://services1.arcgis.com/8zEncYIWRcSKYebe/ArcGIS/rest/services/Basemap/FeatureServer/4";
            break;
          case 2:
            // Standard ArcGIS basemap with flood zone layer from an arcgis.com server
            // Also a parcels layer - from a MapServer
            // As NOT expected by the order of adding the layers, the parcels are still there but covered by the flood zones
            // If you zoom in/out, you can momentarily see parcels, but then the flood comes.
            layer1Url =
              "https://services1.arcgis.com/8zEncYIWRcSKYebe/ArcGIS/rest/services/Safety/FeatureServer/1";
            layer2Url =
              "https://maps.hawaiiinformation.com/maps/rest/services/REsearch_6/Parcels/MapServer";
            break;
          case 3:
            // NO flood zone layer
            // A parcels layer - from a MapServer
            // This shows that the Parcels MapServer layer will show when the flood layer is not there
            //layer1Url = "https://services1.arcgis.com/8zEncYIWRcSKYebe/ArcGIS/rest/services/Safety/FeatureServer/1";
            layer2Url =
              "https://maps.hawaiiinformation.com/maps/rest/services/REsearch_6/Parcels/MapServer";
            break;
        }

        if (layer1Url != "") {
          if (layer1Url.indexOf("FeatureServer") < 0)
            //svcLyr1 = new ArcGISDynamicMapServiceLayer(layer1Url, {
            svcLyr1 = new FeatureLayer(layer1Url, {
              id: "L1",
              visible: true
            });
          else
            svcLyr1 = new FeatureLayer(layer1Url, { id: "L1", visible: true });
          allLayers.push(svcLyr1);
        }
        if (layer2Url != "") {
          if (layer2Url.indexOf("FeatureServer") < 0)
            //svcLyr2 = new ArcGISDynamicMapServiceLayer(layer2Url, {
            svcLyr2 = new FeatureLayer(layer2Url, {
              id: "L2",
              visible: true
            });
          else
            svcLyr2 = new FeatureLayer(layer2Url, { id: "L2", visible: true });
          allLayers.push(svcLyr2);
        }

        map = new Map("map");
        //map.SpatialReference = spRef;
        if (basemapName != "") map.setBasemap(basemapName);

        map.addLayers(allLayers);

        map.on("load", function() {
          // map.reorderLayer(svcLyr1, 0);
          map.centerAndZoom(mapCenter, 15); // just to center on where there is data
        });
      });
    </script>
  </head>
  <body
    class="smart-style-2 fixed-header fixed-navigation fixed-ribbon unselectable claro"
    id="SearchMap_@Model.InstanceId"
    style="position: absolute; width: 100%; height:100%; padding: 0; margin: 0; overflow: hidden"
  >
    <div
      id="map"
      style="position: absolute; left: 0; right: 0; top:0; bottom: 0; border: 0"
    ></div>
  </body>
</html>
